From d25b1435444cfe28422d903fed6d856ece5d5e9b Mon Sep 17 00:00:00 2001
From: Paul Cercueil <paul.cercueil@analog.com>
Date: Mon, 22 May 2017 17:08:37 +0200
Subject: [PATCH 27/72] blocks: stream_to_tagged_stream: Fix tag offset not
 reset after unlock()

Fixes #1091.

Signed-off-by: Paul Cercueil <paul.cercueil@analog.com>
---
 gr-blocks/lib/stream_to_tagged_stream_impl.cc | 7 +++++++
 gr-blocks/lib/stream_to_tagged_stream_impl.h  | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/gr-blocks/lib/stream_to_tagged_stream_impl.cc b/gr-blocks/lib/stream_to_tagged_stream_impl.cc
index 58e1a9c5b0..f0de33a16f 100644
--- a/gr-blocks/lib/stream_to_tagged_stream_impl.cc
+++ b/gr-blocks/lib/stream_to_tagged_stream_impl.cc
@@ -84,6 +84,13 @@ namespace gr {
         return noutput_items;
     }
 
+    bool
+    stream_to_tagged_stream_impl::start()
+    {
+        d_next_tag_pos = 0;
+        return true;
+    }
+
   } /* namespace blocks */
 } /* namespace gr */
 
diff --git a/gr-blocks/lib/stream_to_tagged_stream_impl.h b/gr-blocks/lib/stream_to_tagged_stream_impl.h
index dc9c117765..586bd202fa 100644
--- a/gr-blocks/lib/stream_to_tagged_stream_impl.h
+++ b/gr-blocks/lib/stream_to_tagged_stream_impl.h
@@ -46,6 +46,8 @@ namespace gr {
       int work(int noutput_items,
 	       gr_vector_const_void_star &input_items,
 	       gr_vector_void_star &output_items);
+
+      bool start();
     };
 
   } // namespace blocks
-- 
2.11.0

