From 0d9992d492bf501aa9b31d5872dac801dc362ee8 Mon Sep 17 00:00:00 2001
From: Ron Economos <w6rz@comcast.net>
Date: Mon, 28 Aug 2017 16:08:16 -0700
Subject: [PATCH 68/72] dtv: Send DVB-T Cell identifier (cell_id) correctly.

---
 gr-dtv/lib/dvbt/dvbt_reference_signals_impl.cc | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/gr-dtv/lib/dvbt/dvbt_reference_signals_impl.cc b/gr-dtv/lib/dvbt/dvbt_reference_signals_impl.cc
index aa581aeda8..f92f9fa6d8 100644
--- a/gr-dtv/lib/dvbt/dvbt_reference_signals_impl.cc
+++ b/gr-dtv/lib/dvbt/dvbt_reference_signals_impl.cc
@@ -908,7 +908,12 @@ namespace gr {
       //Clause 4.6.2.9
       set_tps_bits(39, 38, config.d_transmission_mode);
       //Clause 4.6.2.10
-      set_tps_bits(47, 40, config.d_cell_id);
+      if (d_frame_index % 2) {
+        set_tps_bits(47, 40, config.d_cell_id & 0xff);
+      }
+      else {
+        set_tps_bits(47, 40, (config.d_cell_id >> 8) & 0xff);
+      }
       //These bits are set to zero
       set_tps_bits(53, 48, 0);
       //Clause 4.6.2.11
-- 
2.11.0

