From bb21cf83c753e4626de2a0162074c67621db4a10 Mon Sep 17 00:00:00 2001
From: Michael Dickens <michael.dickens@ettus.com>
Date: Fri, 6 Sep 2013 16:05:38 -0400
Subject: [PATCH 16/40] cmake: Fix and cleanup for new Ice library names in
 OSX through macports.

---
 cmake/Modules/FindICE-3.5.cmake |   83 +++++++++++++++++---------------------
 cmake/Modules/FindICE.cmake     |   85 +++++++++++++++++----------------------
 2 files changed, 73 insertions(+), 95 deletions(-)

diff --git a/cmake/Modules/FindICE-3.5.cmake b/cmake/Modules/FindICE-3.5.cmake
index f56a274..dff1967 100644
--- a/cmake/Modules/FindICE-3.5.cmake
+++ b/cmake/Modules/FindICE-3.5.cmake
@@ -9,7 +9,7 @@ if(NOT ICE_FOUND)
   # that exists, get the version string and parse it for the proper
   # version.
   FIND_PATH(
-    ICE_CONFIG_INCLUDE_DIR 
+    ICE_CONFIG_INCLUDE_DIR
     NAMES IceUtil/Config.h
     HINTS ${ICE_MANUAL_INSTALL_PATH}/include/ ${CMAKE_INSTALL_PREFIX}/${HEADER_DIR}
     )
@@ -35,7 +35,7 @@ if(ICE_FOUND)
 string(REGEX REPLACE "/include" "" ICE_PATH ${ICE_CONFIG_INCLUDE_DIR})
 
 FIND_PATH(
-  ICE_INCLUDE_DIR 
+  ICE_INCLUDE_DIR
   NAMES IceUtil/IceUtil.h Ice/Ice.h
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/include
@@ -43,29 +43,29 @@ FIND_PATH(
 
 set(ICE_LIBRARY )
 
-FIND_LIBRARY(
-  ICE_ICESTORM IceStorm 
-  NO_DEFAULT_PATH
-  HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
-)
+if(APPLE)
+  set(ICE_LIB_PREFIX "Zeroc")
+else()
+  set(ICE_LIB_PREFIX "")
+endif(APPLE)
 
 FIND_LIBRARY(
-  ICE_ICESTORM IceStorm
+  ICE_ICE ${ICE_LIB_PREFIX}Ice
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICE Ice
+  ICE_ICESTORM ${ICE_LIB_PREFIX}IceStorm
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICEGRID IceGrid
+  ICE_ICEGRID ${ICE_LIB_PREFIX}IceGrid
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICEUTIL IceUtil
+  ICE_ICEUTIL ${ICE_LIB_PREFIX}IceUtil
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
@@ -75,14 +75,6 @@ FIND_LIBRARY(
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 
-if(APPLE)
-  FIND_LIBRARY(
-    ICE_ZEROCICE ZeroCIce
-    NO_DEFAULT_PATH
-    HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
-    )
-endif(APPLE)
-
 FIND_LIBRARY(
   ICE_PTHREAD NAMES pthread pthread-2.13
   HINTS ${CMAKE_INSTALL_PREFIX}/lib64/ ${CMAKE_INSTALL_PREFIX}/lib/
@@ -92,36 +84,33 @@ FIND_LIBRARY(
 
 set(ICE_FOUND FALSE)
 
-if(ICE_ICE OR ICE_ZEROCICE)
-  if(ICE_ICEUTIL)
-    list(APPEND ICE_LIBRARY
-      ${ICE_ICE}
-      ${ICE_ZEROCICE}
-      ${ICE_ICEUTIL}
-      )
-
-    FIND_PROGRAM(ICE_SLICE2CPP slice2cpp
-      HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
-    FIND_PROGRAM(ICE_SLICE2PY slice2py
-      HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
-
-    # Check that the ICE Python package is installed
-    GR_PYTHON_CHECK_MODULE("Ice >= 3.5" Ice "Ice.stringVersion() >= '3.5.0'" PYTHON_ICE_FOUND)
-    if(PYTHON_ICE_FOUND)
-      set(ICE_FOUND TRUE)
-    endif(PYTHON_ICE_FOUND)
+if(ICE_ICE AND ICE_ICEUTIL)
+  list(APPEND ICE_LIBRARY
+    ${ICE_ICE}
+    ${ICE_ICEUTIL}
+    )
 
-    if(ICE_FOUND)
-      message(STATUS "Ice-3.5 found")
+  FIND_PROGRAM(ICE_SLICE2CPP slice2cpp
+    HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
+  FIND_PROGRAM(ICE_SLICE2PY slice2py
+    HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
 
-      set(ICE_LIBRARIES ${ICE_LIBRARY})
-      set(ICE_INCLUDE_DIRS ${ICE_INCLUDE_DIR})
+  # Check that the ICE Python package is installed
+  GR_PYTHON_CHECK_MODULE("Ice >= 3.5" Ice "Ice.stringVersion() >= '3.5.0'" PYTHON_ICE_FOUND)
+  if(PYTHON_ICE_FOUND)
+    set(ICE_FOUND TRUE)
+  endif(PYTHON_ICE_FOUND)
 
-      include(FindPackageHandleStandardArgs)
-      find_package_handle_standard_args(ICE DEFAULT_MSG ICE_LIBRARY ICE_INCLUDE_DIR)
-      mark_as_advanced(ICE_INCLUDE_DIR ICE_LIBRARY)
-    endif(ICE_FOUND)
-  endif(ICE_ICEUTIL)
-endif(ICE_ICE OR ICE_ZEROCICE)
+  if(ICE_FOUND)
+    message(STATUS "Ice-3.5 found")
+
+    set(ICE_LIBRARIES ${ICE_LIBRARY})
+    set(ICE_INCLUDE_DIRS ${ICE_INCLUDE_DIR})
+
+    include(FindPackageHandleStandardArgs)
+    find_package_handle_standard_args(ICE DEFAULT_MSG ICE_LIBRARY ICE_INCLUDE_DIR)
+    mark_as_advanced(ICE_INCLUDE_DIR ICE_LIBRARY)
+  endif(ICE_FOUND)
+endif(ICE_ICE AND ICE_ICEUTIL)
 
 endif(ICE_FOUND)
diff --git a/cmake/Modules/FindICE.cmake b/cmake/Modules/FindICE.cmake
index 7ce9c2b..6700828 100644
--- a/cmake/Modules/FindICE.cmake
+++ b/cmake/Modules/FindICE.cmake
@@ -9,9 +9,9 @@ if(NOT ICE_FOUND)
   # that exists, get the version string and parse it for the proper
   # version.
   FIND_PATH(
-    ICE_CONFIG_INCLUDE_DIR 
+    ICE_CONFIG_INCLUDE_DIR
     NAMES IceUtil/Config.h
-    HINTS ${CMAKE_INSTALL_PREFIX}/${HEADER_DIR} ${ICE_MANUAL_INSTALL_PATH}/include/
+    HINTS ${ICE_MANUAL_INSTALL_PATH}/include/ ${CMAKE_INSTALL_PREFIX}/${HEADER_DIR}
     )
   if(ICE_CONFIG_INCLUDE_DIR)
     file(STRINGS "${ICE_CONFIG_INCLUDE_DIR}/IceUtil/Config.h"
@@ -36,7 +36,7 @@ if(ICE_FOUND)
 string(REGEX REPLACE "/include" "" ICE_PATH ${ICE_CONFIG_INCLUDE_DIR})
 
 FIND_PATH(
-  ICE_INCLUDE_DIR 
+  ICE_INCLUDE_DIR
   NAMES IceUtil/IceUtil.h Ice/Ice.h
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/include
@@ -44,29 +44,29 @@ FIND_PATH(
 
 set(ICE_LIBRARY )
 
-FIND_LIBRARY(
-  ICE_ICESTORM IceStorm 
-  NO_DEFAULT_PATH
-  HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
-)
+if(APPLE)
+  set(ICE_LIB_PREFIX "Zeroc")
+else()
+  set(ICE_LIB_PREFIX "")
+endif(APPLE)
 
 FIND_LIBRARY(
-  ICE_ICESTORM IceStorm
+  ICE_ICE ${ICE_LIB_PREFIX}Ice
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICE Ice
+  ICE_ICESTORM ${ICE_LIB_PREFIX}IceStorm
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICEGRID IceGrid
+  ICE_ICEGRID ${ICE_LIB_PREFIX}IceGrid
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 FIND_LIBRARY(
-  ICE_ICEUTIL IceUtil
+  ICE_ICEUTIL ${ICE_LIB_PREFIX}IceUtil
   NO_DEFAULT_PATH
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
@@ -76,14 +76,6 @@ FIND_LIBRARY(
   HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
 )
 
-if(APPLE)
-  FIND_LIBRARY(
-    ICE_ZEROCICE ZeroCIce
-    NO_DEFAULT_PATH
-    HINTS ${ICE_PATH}/lib ${ICE_PATH}/lib64
-    )
-endif(APPLE)
-
 FIND_LIBRARY(
   ICE_PTHREAD NAMES pthread pthread-2.13
   HINTS ${CMAKE_INSTALL_PREFIX}/lib64/ ${CMAKE_INSTALL_PREFIX}/lib/
@@ -93,36 +85,33 @@ FIND_LIBRARY(
 
 set(ICE_FOUND FALSE)
 
-if(ICE_ICE OR ICE_ZEROCICE)
-  if(ICE_ICEUTIL)
-    list(APPEND ICE_LIBRARY
-      ${ICE_ICE}
-      ${ICE_ZEROCICE}
-      ${ICE_ICEUTIL}
-      )
-
-    FIND_PROGRAM(ICE_SLICE2CPP slice2cpp
-      HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
-    FIND_PROGRAM(ICE_SLICE2PY slice2py
-      HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
-
-    # Check that the ICE Python package is installed
-    GR_PYTHON_CHECK_MODULE("Ice >= 3.4" Ice "Ice.stringVersion() >= '3.4.0'" PYTHON_ICE_FOUND)
-    if(PYTHON_ICE_FOUND)
-      set(ICE_FOUND TRUE)
-    endif(PYTHON_ICE_FOUND)
+if(ICE_ICE AND ICE_ICEUTIL)
+  list(APPEND ICE_LIBRARY
+    ${ICE_ICE}
+    ${ICE_ICEUTIL}
+    )
 
-    if(ICE_FOUND)
-      message(STATUS "Ice-3.4 found")
+  FIND_PROGRAM(ICE_SLICE2CPP slice2cpp
+    HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
+  FIND_PROGRAM(ICE_SLICE2PY slice2py
+    HINTS ${CMAKE_INSTALL_PREFIX}/bin ${ICE_MANUAL_INSTALL_PATH}/bin/)
 
-      set(ICE_LIBRARIES ${ICE_LIBRARY})
-      set(ICE_INCLUDE_DIRS ${ICE_INCLUDE_DIR})
+  # Check that the ICE Python package is installed
+  GR_PYTHON_CHECK_MODULE("Ice >= 3.4" Ice "Ice.stringVersion() >= '3.4.0'" PYTHON_ICE_FOUND)
+  if(PYTHON_ICE_FOUND)
+    set(ICE_FOUND TRUE)
+  endif(PYTHON_ICE_FOUND)
 
-      include(FindPackageHandleStandardArgs)
-      find_package_handle_standard_args(ICE DEFAULT_MSG ICE_LIBRARY ICE_INCLUDE_DIR)
-      mark_as_advanced(ICE_INCLUDE_DIR ICE_LIBRARY)
-    endif(ICE_FOUND)
-  endif(ICE_ICEUTIL)
-endif(ICE_ICE OR ICE_ZEROCICE)
+  if(ICE_FOUND)
+    message(STATUS "Ice-3.4 found")
+
+    set(ICE_LIBRARIES ${ICE_LIBRARY})
+    set(ICE_INCLUDE_DIRS ${ICE_INCLUDE_DIR})
+
+    include(FindPackageHandleStandardArgs)
+    find_package_handle_standard_args(ICE DEFAULT_MSG ICE_LIBRARY ICE_INCLUDE_DIR)
+    mark_as_advanced(ICE_INCLUDE_DIR ICE_LIBRARY)
+  endif(ICE_FOUND)
+endif(ICE_ICE AND ICE_ICEUTIL)
 
 endif(ICE_FOUND)
-- 
1.7.10.4

