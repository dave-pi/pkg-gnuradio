From cc0ec5b22470af201f8ad949266c8f66597050ed Mon Sep 17 00:00:00 2001
From: Tom Rondeau <trondeau@vt.edu>
Date: Tue, 16 Jul 2013 13:23:54 -0400
Subject: [PATCH 10/31] volk: fix some ARM test functions that resulted in an
 infinite loop on some processors.

---
 volk/tmpl/volk_cpu.tmpl.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/volk/tmpl/volk_cpu.tmpl.c b/volk/tmpl/volk_cpu.tmpl.c
index 81fc679..b1a0a4a 100644
--- a/volk/tmpl/volk_cpu.tmpl.c
+++ b/volk/tmpl/volk_cpu.tmpl.c
@@ -116,10 +116,11 @@ static int has_neon(void){
     auxvec_f = fopen("/proc/self/auxv", "rb");
     if(!auxvec_f) return 0;
 
+    size_t r = 1;
     //so auxv is basically 32b of ID and 32b of value
     //so it goes like this
-    while(!found_neon && auxvec_f) {
-      fread(auxvec, sizeof(unsigned long), 2, auxvec_f);
+    while(!found_neon && r) {
+      r = fread(auxvec, sizeof(unsigned long), 2, auxvec_f);
       if((auxvec[0] == AT_HWCAP) && (auxvec[1] & HWCAP_NEON))
         found_neon = 1;
     }
-- 
1.7.10.4

